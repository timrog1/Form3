<!doctype html>
<html lang="en">

<head>
    <title>payments-grid test</title>

    <script src="../../../webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../../web-component-tester/browser.js"></script>

    <link rel="import" href="../../src/payments-app/payments-grid.html">
</head>

<body>

    <test-fixture id="BasicTestFixture">
        <template>
            <payments-grid data-source="/some-url"></payments-app>
        </template>
    </test-fixture>

    <script>
    suite('when I view the payments-grid', function () {
        var server;
        var responseHeaders = {
            json: { 'Content-Type': 'application/json' }
        };
        var stubData = {
            data: [
                {
                    attributes: {
                        reference: "a payment reference",
                        amount: "100.21"
                    }
                }
            ]
        };

        setup(() => {
            server = sinon.fakeServer.create();
            server.respondImmediately = true;
            server.respondWith('GET', '/some-url', [200, responseHeaders.json, JSON.stringify(stubData)]);
        });

        test('then it shows references in a list', done => {
            var element = fixture('BasicTestFixture');
            
            flush(() => {
                var cells = Polymer.dom(element.root).querySelectorAll('li');
                var text = Array.from(cells).map(td => td.innerText);
                assert.include(text, 'a payment reference');
                done();
            });
        });

        teardown(function () {
            server.restore();
        });
    });
</script>


</body>

</html>